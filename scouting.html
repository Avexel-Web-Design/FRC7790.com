<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <link rel="shortcut icon" type="image/png" href="public/assets/images/logo.png" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Scouting - FRC Team 7790 - Baywatch Robotics</title>
    <meta
      name="description"
      content="Team scouting tool for FRC events - view and rank teams by EPA stats."
    />
    <meta
      name="keywords"
      content="FRC, FIRST Robotics, Team 7790, Baywatch Robotics, Harbor Springs, Michigan, Scouting, EPA"
    />
    <link rel="canonical" href="https://www.frc7790.com/scouting.html" />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="Team Scouting - FRC Team 7790" />
    <meta
      property="og:description"
      content="Team scouting tool for FRC events"
    />
    <meta
      property="og:image"
      content="https://www.frc7790.com/src/assets/images/baywatchLogo.png"
    />
    <meta property="og:url" content="https://www.frc7790.com/scouting.html" />
    <meta property="og:type" content="website" />

    <!-- Add Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "baywatch-orange": "#FF6B00",
              "baywatch-dark": "#1A1A1A",
            },
            fontFamily: {
              poppins: ["Poppins", "sans-serif"],
            },
          },
        },
      };
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <link href="public/styles/main.css" rel="stylesheet" />
    <script src="public/js/animations.js" defer></script>
    <script src="public/js/search.js" defer></script>
    <script src="public/js/statbotics.js" defer></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>
  <body class="bg-black text-white overflow-x-hidden font-poppins">
    <!-- Navigation Bar -->
    <nav
      class="fixed top-0 w-full z-50 transition-all duration-300"
      id="navbar"
    >
      <div
        class="container mx-auto px-6 py-4 flex items-center justify-between"
      >
        <div class="flex items-center space-x-2">
          <a
            href="index.html#"
            class="flex items-center space-x-2 scroll-smooth transition-all duration-300 hover:scale-105"
          >
            <img
              src="public/assets/images/logo.png"
              alt="Baywatch Robotics Logo"
              class="w-20 h-20"
            />
          </a>
        </div>
        
        <!-- Search Bar (New Addition) -->
        <div class="hidden md:flex items-center bg-black/30 rounded-lg border border-gray-700 hover:border-baywatch-orange/50 transition-all duration-300 px-3 py-1 mx-4 flex-grow max-w-md">
          <input 
            type="text" 
            id="search-input" 
            placeholder="Search team # or event code..." 
            class="bg-transparent border-none focus:outline-none text-white w-full"
            aria-label="Search for team or event">
          <button 
            id="search-button"
            class="text-gray-400 hover:text-baywatch-orange transition-colors"
            aria-label="Search">
            <i class="fas fa-search"></i>
          </button>
        </div>
        
        <!-- Desktop Menu -->
        <ul class="hidden md:flex space-x-8">
          <li>
            <a
              href="robots.html"
              class="hover:text-baywatch-orange transition-all duration-300 hover:scale-110 inline-block"
              >Robots</a
            >
          </li>
          <li>
            <a
              href="sponsors.html"
              class="hover:text-baywatch-orange transition-all duration-300 hover:scale-110 inline-block"
              >Sponsors</a
            >
          </li>
          <li>
            <a
              href="schedule.html"
              class="hover:text-baywatch-orange transition-all duration-300 hover:scale-110 inline-block"
              >Schedule</a
            >
          </li>
          <li>
            <a
              href="scouting.html"
              class="text-baywatch-orange transition-all duration-300 hover:scale-110 inline-block"
              >Scouting</a
            >
          </li>
          <li>
            <a
              href="ftc.html"
              class="hover:text-baywatch-orange transition-all duration-300 hover:scale-110 inline-block"
              >FTC</a
            >
          </li>
        </ul>
        <!-- Mobile Menu Button -->
        <div class="md:hidden">
          <button
            id="mobile-menu-btn"
            class="focus:outline-none transition-transform duration-300"
          >
            <i class="fas fa-bars text-3xl"></i>
          </button>
        </div>
      </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div
      id="mobile-menu-overlay"
      class="fixed inset-0 bg-gradient-to-b from-baywatch-dark to-black opacity-95 hidden z-40 transition-opacity duration-300 animate__animated"
    >
      <!-- Mobile Search Bar -->
      <div class="px-8 pt-32 pb-4">
        <div class="flex items-center bg-black/50 rounded-lg border border-gray-700 px-3 py-2">
          <input 
            type="text" 
            id="mobile-search-input" 
            placeholder="Search team # or event code..." 
            class="bg-transparent border-none focus:outline-none text-white w-full"
            aria-label="Search for team or event">
          <button 
            id="mobile-search-button"
            class="text-gray-400 hover:text-baywatch-orange transition-colors"
            aria-label="Search">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
      
      <div class="flex flex-col items-center justify-center h-full space-y-8 -mt-32">
        <a
          href="robots.html"
          class="text-2xl text-white transition-all duration-300 hover:text-baywatch-orange hover:scale-110 px-4 py-2 bg-black/20 rounded-lg"
          >Robots</a
        >
        <a
          href="sponsors.html"
          class="text-2xl text-white transition-all duration-300 hover:text-baywatch-orange hover:scale-110 px-4 py-2 bg-black/20 rounded-lg"
          >Sponsors</a
        >
        <a
          href="schedule.html"
          class="text-2xl text-white transition-all duration-300 hover:text-baywatch-orange hover:scale-110 px-4 py-2 bg-black/20 rounded-lg"
          >Schedule</a
        >
        <a
          href="ftc.html"
          class="text-2xl text-white transition-all duration-300 hover:text-baywatch-orange hover:scale-110 px-4 py-2 bg-black/20 rounded-lg"
          >FTC</a
        >
        <a
          href="scouting.html"
          class="text-2xl text-baywatch-orange transition-all duration-300 hover:scale-110 px-4 py-2 bg-black/20 rounded-lg"
          >Scouting</a
        >
      </div>
    </div>

    <!-- Mobile Menu Toggle Script -->
    <script>
      const menuBtn = document.getElementById("mobile-menu-btn");
      const mobileMenu = document.getElementById("mobile-menu-overlay");
      let menuOpen = false;

      menuBtn.addEventListener("click", () => {
        menuOpen = !menuOpen;

        if (menuOpen) {
          // Show menu with slide-down effect
          mobileMenu.classList.remove("hidden");
          mobileMenu.classList.remove("animate__fadeOutUp");
          mobileMenu.classList.add("animate__fadeInDown");
          // Rotate hamburger to X
          menuBtn.firstElementChild.classList.remove("fa-bars");
          menuBtn.firstElementChild.classList.add(
            "fa-times",
            "animate__animated",
            "animate__rotateIn"
          );
        } else {
          // Animate hide menu with slide-up effect then hide
          mobileMenu.classList.remove("animate__fadeInDown");
          mobileMenu.classList.add("animate__fadeOutUp");
          // Rotate X back to hamburger
          menuBtn.firstElementChild.classList.remove(
            "fa-times",
            "animate__rotateIn"
          );
          menuBtn.firstElementChild.classList.add(
            "fa-bars",
            "animate__animated",
            "animate__rotateIn"
          );
          // After animation, add hidden class
          setTimeout(() => {
            mobileMenu.classList.add("hidden");
          }, 500);
        }
      });
    </script>

    <!-- Hero Section with reduced padding -->
    <section class="relative pt-24 pb-16 bg-black"> <!-- Reduced top and bottom padding -->
      <div class="container mx-auto px-6">
        <div class="flex flex-col items-center justify-center text-center">
          <h1 class="text-4xl md:text-5xl font-bold mb-4 text-white">
            Team <span class="text-baywatch-orange">Scouting</span> Tool
          </h1>
          <p class="text-gray-300 max-w-2xl mx-auto mb-8">
            Compare and rank teams at events using EPA (Expected Points Added) 
            statistics from Statbotics. Track team selection during alliance selections.
          </p>
          
          <!-- Event Selection - Simplified with integrated search -->
          <div class="w-full max-w-xl mx-auto mb-8">
            <div class="bg-black/30 card-gradient rounded-lg p-6 backdrop-blur-sm border border-gray-800">
              <label for="event-input" class="block text-sm font-medium text-gray-300 mb-3 text-left">Enter Event Code</label>
              <div class="flex items-center gap-3">
                <div class="relative flex-grow">
                  <input 
                    type="text" 
                    id="event-input" 
                    placeholder="Enter event code (e.g., 2025milac)" 
                    class="bg-black/40 rounded-lg border border-gray-700 hover:border-baywatch-orange/50 focus:border-baywatch-orange/70 transition-all duration-300 px-4 py-3 w-full text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-baywatch-orange/30">
                  <button 
                    id="load-event-button"
                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-baywatch-orange transition-colors bg-transparent p-1 rounded-full hover:bg-black/30">
                    <i class="fas fa-search text-lg"></i>
                  </button>
                </div>
              </div>
              <div class="flex justify-between mt-3">
                <p class="text-xs text-gray-500">Try these completed events:</p>
                <div class="flex gap-2">
                  <span class="text-baywatch-orange cursor-pointer event-suggestion text-xs hover:underline">2025milac</span>
                  <span class="text-gray-500 text-xs">|</span>
                  <span class="text-baywatch-orange cursor-pointer event-suggestion text-xs hover:underline">2024mitvc</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Decorative Elements -->
      <div class="absolute bottom-0 left-0 w-full h-1/2 pointer-events-none overflow-hidden">
        <svg class="absolute bottom-0 left-0 w-full" viewBox="0 0 1440 320" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
          <path fill-opacity="0.03" fill="#FF6B00" d="M0,224L48,208C96,192,192,160,288,165.3C384,171,480,213,576,208C672,203,768,149,864,144C960,139,1056,181,1152,181.3C1248,181,1344,139,1392,117.3L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
        </svg>
      </div>
    </section>

    <!-- Main Content with reduced top padding -->
    <section class="py-8 bg-black"> <!-- Reduced top padding -->
      <div class="container mx-auto px-6">
        <!-- Error Message Banner -->
        <div id="error-message" class="hidden mb-6 bg-red-900/50 border border-red-800 text-red-100 px-4 py-3 rounded-lg animate__animated animate__fadeIn">
          <div class="flex items-start">
            <div class="flex-shrink-0">
              <i class="fas fa-exclamation-circle mt-0.5"></i>
            </div>
            <div class="ml-3">
              <h3 class="text-sm font-medium" id="error-title">Event Not Found</h3>
              <div class="mt-1 text-sm" id="error-description">
                This event wasn't found in the Statbotics database. Try using a completed event code like "2025milac" (Michigan State Championship 2023).
              </div>
            </div>
          </div>
        </div>

        <!-- Event Info -->
        <div id="event-info" class="mb-16 hidden animate__animated animate__fadeIn"> <!-- Increased margin-bottom from 12 to 16 -->
          <div class="bg-black/20 card-gradient rounded-lg border border-gray-800 p-6">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
              <div>
                <h2 id="event-name" class="text-2xl font-bold mb-2">Event Name</h2>
                <div class="flex flex-wrap gap-x-8 gap-y-2 text-sm text-gray-300">
                  <div id="event-date" class="flex items-center"><i class="far fa-calendar-alt mr-2 text-baywatch-orange"></i>Date: --</div>
                  <div id="event-location" class="flex items-center"><i class="fas fa-map-marker-alt mr-2 text-baywatch-orange"></i>Location: --</div>
                  <div id="teams-count" class="flex items-center"><i class="fas fa-users mr-2 text-baywatch-orange"></i>Teams: --</div>
                </div>
              </div>
              <div class="flex gap-2">
                <a id="tba-event-link" href="#" target="_blank" class="px-4 py-2 bg-blue-600/30 hover:bg-blue-600/50 text-blue-300 rounded-lg transition-all flex items-center">
                  <i class="fas fa-external-link-alt mr-2"></i> TBA
                </a>
                <a id="statbotics-event-link" href="#" target="_blank" class="px-4 py-2 bg-gray-600/30 hover:bg-gray-600/50 text-gray-300 rounded-lg transition-all flex items-center">
                  <i class="fas fa-chart-bar mr-2"></i> Statbotics
                </a>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Stats Control Panel with simplified sort options -->
        <div class="mb-12 mt-8 bg-black/30 card-gradient rounded-lg p-6 border border-gray-800"> <!-- Added mt-8 for top margin -->
          <div class="flex flex-col md:flex-row gap-6 justify-between items-center">
            <div class="flex gap-6 flex-wrap justify-center w-full md:w-auto">
              <div>
                <label for="sort-stat" class="block text-sm font-medium text-gray-300 mb-2">Sort By:</label>
                <div class="relative">
                  <select id="sort-stat" class="appearance-none bg-black/50 text-white border border-gray-700 rounded-lg px-4 py-2.5 pr-10 focus:outline-none focus:ring-1 focus:ring-baywatch-orange focus:border-baywatch-orange/50 cursor-pointer transition-all duration-300 w-full">
                    <option value="epa_total">Total EPA</option>
                    <option value="epa_auto">Auto EPA</option>
                    <option value="epa_teleop">Teleop EPA</option>
                    <option value="epa_endgame">Endgame EPA</option>
                    <option value="team">Team Number</option>
                  </select>
                  <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                    <i class="fas fa-chevron-down text-xs"></i>
                  </div>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">View Options:</label>
                <button 
                  id="toggle-picked"
                  class="px-4 py-2.5 bg-black/50 hover:bg-gray-800 text-white rounded-lg transition-all duration-300 flex items-center justify-center border border-gray-700 hover:border-gray-600 w-full">
                  <i class="fas fa-filter mr-2"></i> Show Available Only
                </button>
              </div>
            </div>
            <div class="w-full md:w-auto">
              <button 
                id="clear-picked"
                class="px-4 py-2.5 bg-black/50 hover:bg-red-900/70 text-white rounded-lg transition-all duration-300 flex items-center justify-center border border-red-900/30 hover:border-red-800 w-full md:w-auto">
                <i class="fas fa-trash-alt mr-2"></i> Clear All Picked Teams
              </button>
            </div>
          </div>
        </div>
        
        <!-- Loading Indicator -->
        <div id="loading-indicator" class="hidden flex flex-col justify-center items-center py-12 my-8 animate__animated animate__fadeIn">
          <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-baywatch-orange mb-4"></div>
          <p class="text-gray-400">Loading team data...</p>
        </div>

        <!-- No Teams Message -->
        <div id="no-teams-message" class="hidden text-center py-16 my-8 text-gray-400 animate__animated animate__fadeIn">
          <i class="fas fa-robot text-6xl mb-4 text-gray-600"></i>
          <p class="text-xl">No teams found for this event.</p>
          <p class="mt-2">Please check the event code and try again.</p>
        </div>
        
        <!-- Teams Table Container -->
        <div class="overflow-x-auto rounded-lg border border-gray-800 bg-black/90 shadow-2xl hover:shadow-baywatch-orange/30 transition-all duration-500 card-container group mb-12">
          <!-- Pattern Overlay -->
          <div class="absolute inset-0 opacity-5 bg-[radial-gradient(circle_at_1px_1px,_rgb(255,107,0,0.2)_1px,_transparent_0)] bg-[size:20px_20px] rounded-lg pointer-events-none"></div>
          
          <table class="min-w-full relative z-10">
            <thead>
              <tr class="bg-black/70 border-b border-gray-800">
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Rank</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Team</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Name</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Total EPA</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Auto EPA</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Teleop EPA</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Endgame EPA</th>
                <th class="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider">Picked</th>
              </tr>
            </thead>
            <tbody id="teams-table-body" class="bg-transparent">
              <!-- Team rows will be added here dynamically -->
              <tr class="border-b border-gray-800">
                <td colspan="8" class="px-4 py-10 text-center text-gray-500">
                  <i class="fas fa-search text-2xl mb-4 text-gray-600"></i>
                  <p>Enter an event code and press Enter or click the search icon to view team statistics</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Tips Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
          <!-- Left Card -->
          <div class="bg-black/20 card-gradient rounded-lg p-6 border border-gray-800 reveal">
            <div class="flex items-center mb-4">
              <div class="bg-baywatch-orange/20 p-3 rounded-full mr-4">
                <i class="fas fa-chart-line text-baywatch-orange text-xl"></i>
              </div>
              <h3 class="text-xl font-bold">Understanding EPA</h3>
            </div>
            <p class="text-gray-300 mb-4">
              EPA (Expected Points Added) is a statistical measure of a team's performance developed by Statbotics. Higher values indicate better expected performance.
            </p>
            <ul class="space-y-2 text-gray-400">
              <li class="flex items-start">
                <i class="fas fa-check text-white-400 mr-2 mt-1"></i>
                <span><strong class="text-white">Total EPA:</strong> Overall expected point contribution</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check text-white-400 mr-2 mt-1"></i>
                <span><strong class="text-white">Auto EPA:</strong> Points expected during autonomous</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check text-white-400 mr-2 mt-1"></i>
                <span><strong class="text-white">Teleop EPA:</strong> Points expected during teleop</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check text-white-400 mr-2 mt-1"></i>
                <span><strong class="text-white">Endgame EPA:</strong> Points expected from endgame tasks</span>
              </li>
            </ul>
          </div>
          
          <!-- Right Card -->
          <div class="bg-black/20 card-gradient rounded-lg p-6 border border-gray-800 reveal">
            <div class="flex items-center mb-4">
              <div class="bg-baywatch-orange/20 p-3 rounded-full mr-4">
                <i class="fas fa-lightbulb text-baywatch-orange text-xl"></i>
              </div>
              <h3 class="text-xl font-bold">Using This Tool</h3>
            </div>
            <p class="text-gray-300 mb-4">
              This scouting tool helps you track and compare teams at FRC events using data from Statbotics.
            </p>
            <ul class="space-y-2 text-gray-400">
              <li class="flex items-start">
                <i class="fas fa-check text-white-400 mr-2 mt-1"></i>
                <span><strong class="text-white">Mark teams:</strong> Click checkboxes to track which teams have been picked</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check text-white-400 mr-2 mt-1"></i>
                <span><strong class="text-white">Sort data:</strong> Use the dropdown to sort by different metrics</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check text-white-400 mr-2 mt-1"></i>
                <span><strong class="text-white">Filter view:</strong> Toggle between all teams or available teams only</span>
              </li>
              <li class="flex items-start">
                <i class="fas fa-check text-white-400 mr-2 mt-1"></i>
                <span><strong class="text-white">Find events:</strong> Use event codes from <a href="https://www.thebluealliance.com" class="text-baywatch-orange hover:underline" target="_blank">The Blue Alliance</a></span>
              </li>
            </ul>
          </div>
        </div>
        
        <!-- Data Attribution -->
        <div class="text-center text-sm text-gray-500 mb-4">
          <p>Data provided by <a href="https://www.statbotics.io" class="text-baywatch-orange hover:underline" target="_blank">Statbotics</a> | 
          Event information from <a href="https://www.thebluealliance.com" class="text-baywatch-orange hover:underline" target="_blank">The Blue Alliance</a></p>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="bg-black border-t border-gray-900 py-12">
      <div class="container mx-auto px-6">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div class="flex space-x-4 mb-4 md:mb-0">
            <a
              href="https://youtube.com/@frc7790"
              class="text-baywatch-orange hover:text-orange-700 text-2xl social-icon youtube"
            >
              <i class="fab fa-youtube"></i>
            </a>
            <a
              href="https://instagram.com/frc7790"
              class="text-baywatch-orange hover:text-orange-700 text-2xl social-icon instagram"
            >
              <i class="fab fa-instagram"></i>
            </a>
          </div>
          <div class="text-gray-400 text-sm">
            © 2025 Baywatch Robotics. All rights reserved.
          </div>
        </div>
      </div>
    </footer>

    <!-- JavaScript for Statbotics API and Team Management -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const eventInput = document.getElementById('event-input');
        const loadEventButton = document.getElementById('load-event-button');
        const loadEventButtonAlt = document.getElementById('load-event-button-alt');
        const sortStatSelect = document.getElementById('sort-stat');
        const togglePickedButton = document.getElementById('toggle-picked');
        const clearPickedButton = document.getElementById('clear-picked');
        const teamsTableBody = document.getElementById('teams-table-body');
        const loadingIndicator = document.getElementById('loading-indicator');
        const eventInfo = document.getElementById('event-info');
        const eventNameElement = document.getElementById('event-name');
        const eventDateElement = document.getElementById('event-date');
        const eventLocationElement = document.getElementById('event-location');
        const teamsCountElement = document.getElementById('teams-count');
        const noTeamsMessage = document.getElementById('no-teams-message');
        const errorMessage = document.getElementById('error-message');
        const errorTitle = document.getElementById('error-title');
        const errorDescription = document.getElementById('error-description');
        const tbaEventLink = document.getElementById('tba-event-link');
        const statboticsEventLink = document.getElementById('statbotics-event-link');
        
        // Quick event suggestions
        document.querySelectorAll('.event-suggestion').forEach(suggestion => {
          suggestion.addEventListener('click', () => {
            eventInput.value = suggestion.textContent.trim();
            loadEventTeams(eventInput.value.trim());
          });
        });
        
        // State variables
        let teamsData = [];
        let currentSortKey = 'epa_total';
        let showOnlyAvailable = false;
        
        // Populate sort dropdown with additional EPA metrics - SIMPLIFIED to avoid too many options
        const populateSortOptions = () => {
          // We'll keep only the basic options that are already defined in the HTML
          // No additional metrics will be added dynamically to avoid confusion
        };
        
        // Load teams from local storage if they exist
        const loadPickedTeamsFromStorage = () => {
          const storedData = localStorage.getItem('pickedTeams');
          return storedData ? JSON.parse(storedData) : {};
        };
        
        // Save teams to local storage
        const savePickedTeamsToStorage = (pickedTeams) => {
          localStorage.setItem('pickedTeams', JSON.stringify(pickedTeams));
        };
        
        let pickedTeams = loadPickedTeamsFromStorage();
        
        // Hide error message
        const hideError = () => {
          errorMessage.classList.add('hidden');
        };
        
        // Show error message
        const showError = (title, description) => {
          errorTitle.textContent = title;
          errorDescription.textContent = description;
          errorMessage.classList.remove('hidden');
          
          // Hide loading indicator if it's shown
          loadingIndicator.classList.add('hidden');
        };
        
        // Format EPA value with appropriate colors
        const formatEPAValue = (value) => {
          if (value === null || value === undefined) return '<span class="text-gray-500">--</span>';
          
          let colorClass = 'text-gray-300';
          if (value > 1.5) colorClass = 'text-white-400';
          else if (value > 0.5) colorClass = 'text-white-300/80';
          else if (value < -0.5) colorClass = 'text-red-300';
          
          return `<span class="${colorClass}">${value.toFixed(2)}</span>`;
        };

        // Fetch event details from Statbotics v3 API
        const fetchEventDetails = async (eventCode) => {
          try {
            const response = await fetch(`https://api.statbotics.io/v3/event/${eventCode}`);
            if (!response.ok) {
              if (response.status === 404) {
                throw new Error(`Event ${eventCode} not found. Please check the event code and try again.`);
              }
              throw new Error(`Failed to fetch event details: ${response.status}`);
            }
            return await response.json();
          } catch (error) {
            console.error('Error fetching event details:', error);
            showError('Event Not Found', `The event "${eventCode}" wasn't found in the Statbotics database. Try using a past event code like "2025milac" or "2023cur".`);
            return null;
          }
        };
        
        // Update UI with event information
        const updateEventInfo = (eventData) => {
          if (!eventData) {
            eventInfo.classList.add('hidden');
            return;
          }
          
          eventNameElement.textContent = eventData.name;
          
          // Format dates properly with error handling
          try {
            const startDate = eventData.start_date ? new Date(eventData.start_date).toLocaleDateString() : '?';
            const endDate = eventData.end_date ? new Date(eventData.end_date).toLocaleDateString() : '?';
            eventDateElement.innerHTML = `<i class="far fa-calendar-alt mr-2 text-baywatch-orange"></i>Date: ${startDate} - ${endDate}`;
          } catch (e) {
            eventDateElement.innerHTML = '<i class="far fa-calendar-alt mr-2 text-baywatch-orange"></i>Date: Not available';
          }
          
          const location = [eventData.state, eventData.country].filter(Boolean).join(', ');
          eventLocationElement.innerHTML = `<i class="fas fa-map-marker-alt mr-2 text-baywatch-orange"></i>Location: ${location || 'Not specified'}`;
          teamsCountElement.innerHTML = `<i class="fas fa-users mr-2 text-baywatch-orange"></i>Teams: ${eventData.num_teams || '0'}`;
          
          // Set up external links
          tbaEventLink.href = `https://www.thebluealliance.com/event/${eventData.key}`;
          statboticsEventLink.href = `https://www.statbotics.io/event/${eventData.key}`;
          
          eventInfo.classList.remove('hidden');
        };

        // Fetch team details for an event from Statbotics v3 API
        const fetchEventTeams = async (eventCode) => {
          try {
            // Fetch team event data for all teams at the specified event
            const response = await fetch(`https://api.statbotics.io/v3/team_events?event=${eventCode}&limit=100`);
            if (!response.ok) {
              if (response.status === 404) {
                throw new Error(`No teams found for event ${eventCode}.`);
              }
              throw new Error(`Failed to fetch event teams: ${response.status}`);
            }
            const data = await response.json();
            
            // Transform the data to match our expected format
            return data.map(teamEvent => {
              // Store all EPA-related data in an epa object
              const epaMetrics = teamEvent.epa?.breakdown || {};
              
              return {
                team: teamEvent.team,
                name: teamEvent.team_name,
                epa_total: teamEvent.epa?.breakdown?.total_points || null,
                epa_auto: teamEvent.epa?.breakdown?.auto_points || null,
                epa_teleop: teamEvent.epa?.breakdown?.teleop_points || null,
                epa_endgame: teamEvent.epa?.breakdown?.endgame_points || null,
                epa: epaMetrics // Store all EPA metrics for additional sorting options
              };
            });
          } catch (error) {
            console.error('Error fetching event teams:', error);
            return [];
          }
        };
        
        // Sort teams based on current sort key
        const sortTeams = () => {
          if (currentSortKey === 'team') {
            teamsData.sort((a, b) => a.team - b.team);
          } else if (currentSortKey.startsWith('epa_')) {
            // Handle standard EPA metrics
            const metricKey = currentSortKey.substring(4); // Remove 'epa_' prefix
            
            teamsData.sort((a, b) => {
              let valA, valB;
              
              // First check if it's one of our standard extracted metrics
              if (a[currentSortKey] !== undefined) {
                valA = a[currentSortKey] !== null ? a[currentSortKey] : -9999;
                valB = b[currentSortKey] !== null ? b[currentSortKey] : -9999;
              } 
              // Otherwise look in the epa object for other metrics
              else if (a.epa && b.epa) {
                valA = a.epa[metricKey] !== null && a.epa[metricKey] !== undefined ? a.epa[metricKey] : -9999;
                valB = b.epa[metricKey] !== null && b.epa[metricKey] !== undefined ? b.epa[metricKey] : -9999;
              } else {
                valA = -9999;
                valB = -9999;
              }
              
              return valB - valA; // Descending order
            });
          }
        };
        
        // Render team rows in the table
        const renderTeams = () => {
          teamsTableBody.innerHTML = '';
          
          // Apply current sort
          sortTeams();
          
          // Filter if showing only available teams
          const teamsToRender = showOnlyAvailable 
            ? teamsData.filter(team => !pickedTeams[team.team])
            : teamsData;
          
          if (teamsToRender.length === 0) {
            teamsTableBody.innerHTML = `
              <tr class="border-b border-gray-800">
                <td colspan="8" class="px-4 py-10 text-center text-gray-500">
                  No teams to display${showOnlyAvailable ? ' (all teams have been picked)' : ''}.
                </td>
              </tr>
            `;
            return;
          }
          
          // Add row for each team
          teamsToRender.forEach((team, index) => {
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-800 hover:bg-black/50 transition-colors';
            if (pickedTeams[team.team]) {
              row.classList.add('bg-gray-900/40');
            }
            
            const isPicked = pickedTeams[team.team] || false;
            
            row.innerHTML = `
              <td class="px-4 py-4">${index + 1}</td>
              <td class="px-4 py-4 font-medium ${isPicked ? 'text-gray-500' : 'text-baywatch-orange'}">${team.team}</td>
              <td class="px-4 py-4 ${isPicked ? 'text-gray-500' : ''}">${team.name || '---'}</td>
              <td class="px-4 py-4">${formatEPAValue(team.epa_total)}</td>
              <td class="px-4 py-4">${formatEPAValue(team.epa_auto)}</td>
              <td class="px-4 py-4">${formatEPAValue(team.epa_teleop)}</td>
              <td class="px-4 py-4">${formatEPAValue(team.epa_endgame)}</td>
              <td class="px-4 py-4 text-center">
                <div class="inline-block relative">
                  <input 
                    type="checkbox" 
                    id="team-${team.team}" 
                    class="team-status-checkbox opacity-0 absolute h-5 w-5 cursor-pointer z-10"
                    data-team="${team.team}"
                    ${isPicked ? 'checked' : ''}
                  >
                  <label 
                    for="team-${team.team}" 
                    class="team-status-label flex items-center cursor-pointer"
                  >
                    <span class="h-5 w-5 flex items-center justify-center border border-gray-600 rounded bg-black/50 mr-2 transition-all">
                      <svg class="w-3 h-3 text-white fill-current hidden" viewBox="0 0 20 20">
                        <path d="M0 11l2-2 5 5L18 3l2 2L7 18z" />
                      </svg>
                    </span>
                    <span class="sr-only">Mark as picked</span>
                  </label>
                </div>
              </td>
            `;
            
            teamsTableBody.appendChild(row);
          });
          
          // Add event listeners for checkboxes
          document.querySelectorAll('.team-status-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
              const teamNumber = parseInt(this.dataset.team, 10);
              toggleTeamPickedStatus(teamNumber);
              
              // Update the checkbox display manually
              const checkSvg = this.nextElementSibling.querySelector('svg');
              if (this.checked) {
                checkSvg.classList.remove('hidden');
                this.nextElementSibling.querySelector('span').classList.add('bg-baywatch-orange');
                this.nextElementSibling.querySelector('span').classList.add('border-baywatch-orange');
              } else {
                checkSvg.classList.add('hidden');
                this.nextElementSibling.querySelector('span').classList.remove('bg-baywatch-orange');
                this.nextElementSibling.querySelector('span').classList.remove('border-baywatch-orange');
              }
            });
          });
        };
        
        // Toggle a team's picked status
        const toggleTeamPickedStatus = (teamNumber) => {
          pickedTeams[teamNumber] = !pickedTeams[teamNumber];
          savePickedTeamsToStorage(pickedTeams);
          renderTeams();
        };
        
        // Load teams for an event
        const loadEventTeams = async (eventCode) => {
          if (!eventCode) return;
          
          // Reset UI state
          hideError();
          teamsTableBody.innerHTML = '';
          loadingIndicator.classList.remove('hidden');
          noTeamsMessage.classList.add('hidden');
          eventInfo.classList.add('hidden');
          
          // Fetch event details
          const eventData = await fetchEventDetails(eventCode);
          
          // If event details failed, error is already displayed
          if (!eventData) {
            loadingIndicator.classList.add('hidden');
            return;
          }
          
          updateEventInfo(eventData);
          
          // Fetch teams for the event
          const teams = await fetchEventTeams(eventCode);
          
          // Hide loading indicator
          loadingIndicator.classList.add('hidden');
          
          // Show message if no teams found
          if (!teams || teams.length === 0) {
            noTeamsMessage.classList.remove('hidden');
            teamsData = [];
            renderTeams();
            return;
          }
          
          teamsData = teams;
          // Populate sort options based on available EPA metrics
          populateSortOptions();
          renderTeams();
        };
        
        // Event listeners
        loadEventButton.addEventListener('click', () => {
          loadEventTeams(eventInput.value.trim());
        });
        
        eventInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            loadEventTeams(eventInput.value.trim());
          }
        });
        
        sortStatSelect.addEventListener('change', () => {
          currentSortKey = sortStatSelect.value;
          renderTeams();
        });
        
        togglePickedButton.addEventListener('click', () => {
          showOnlyAvailable = !showOnlyAvailable;
          togglePickedButton.innerHTML = showOnlyAvailable ? 
            '<i class="fas fa-eye mr-2"></i> Show All Teams' : 
            '<i class="fas fa-filter mr-2"></i> Show Available Only';
          renderTeams();
        });
        
        clearPickedButton.addEventListener('click', () => {
          if (confirm('Are you sure you want to clear all picked teams?')) {
            pickedTeams = {};
            savePickedTeamsToStorage(pickedTeams);
            renderTeams();
          }
        });
        
        // Activate reveal animations
        const revealElements = document.querySelectorAll('.reveal');
        const animateReveal = () => {
          revealElements.forEach(element => {
            const elementTop = element.getBoundingClientRect().top;
            const elementVisible = 150;
            if (elementTop < window.innerHeight - elementVisible) {
              element.classList.add('active');
            }
          });
        };
        
        window.addEventListener('scroll', animateReveal);
        // Trigger on page load too
        setTimeout(animateReveal, 300);
        
        // Check URL for event parameter
        const urlParams = new URLSearchParams(window.location.search);
        const eventParam = urlParams.get('event');
        
        if (eventParam) {
          eventInput.value = eventParam;
          loadEventTeams(eventParam);
        }
      });
    </script>
    
    <!-- Fix for table height and display and checkbox issues -->
    <style>
      /* Force proper table height */
      .overflow-x-auto {
        min-height: 200px;
        position: relative;
      }
      
      /* Enhance table hover effect like About Us card */
      .card-container {
        border: 1px solid rgba(255, 107, 0, 0.3);
        position: relative;
        overflow: hidden;
      }
      
      .card-container:hover {
        transform: translateY(-5px);
        border-color: rgba(255, 107, 0, 0.5);
      }
      
      /* Make table rows get brighter on container hover */
      .group:hover tr:not(:hover) {
        background-color: rgba(0, 0, 0, 0.3);
      }
      
      .group:hover tr:hover {
        background-color: rgba(255, 107, 0, 0.1);
      }
      
      /* Create a glow effect on the container when hovered */
      .card-container::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(to right, transparent, rgba(255, 107, 0, 0.5), transparent);
        opacity: 0;
        transition: opacity 0.5s ease;
      }
      
      .card-container:hover::after {
        opacity: 1;
      }
      
      /* Ensure rows have proper height */
      #teams-table-body tr {
        min-height: 45px;
        transition: background-color 0.3s ease;
      }
      
      /* Better spacing for cells */
      #teams-table-body td {
        padding-top: 12px;
        padding-bottom: 12px;
      }
      
      /* Fix overlapping elements */
      .container {
        position: relative;
        z-index: 5;
      }
      
      /* Ensure background is fully black */
      html, body {
        background-color: #000000 !important;
      }
      
      .bg-baywatch-dark {
        background-color: #000000 !important;
      }
      
      /* Fix table spacing issues */
      table {
        border-collapse: separate;
        border-spacing: 0;
      }
      
      /* Ensure table header is visible */
      thead {
        position: relative;
        z-index: 10;
      }
      
      /* Add spacing between table rows */
      tbody tr:not(:last-child) {
        margin-bottom: 2px;
      }
      
      /* New Custom Checkbox Styling */
      .team-status-checkbox:checked + .team-status-label span {
        border-color: #FF6B00;
        background-color: #FF6B00;
      }
      
      .team-status-checkbox:checked + .team-status-label svg {
        display: block;
      }
      
      .team-status-checkbox:focus + .team-status-label span {
        box-shadow: 0 0 0 2px rgba(255, 107, 0, 0.3);
      }

      /* Fix visual glitch with multiple checkboxes */
      .team-status-checkbox {
        position: absolute;
        opacity: 0;
        z-index: -1; /* Make sure it's hidden */
      }
      
      .team-status-label {
        display: inline-flex;
        align-items: center;
        cursor: pointer;
      }
      
      /* Custom select styling */
      select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-image: none !important;
      }
      
      /* Fix mobile layout */
      @media (max-width: 768px) {
        #toggle-picked, #clear-picked {
          width: 100%;
        }
      }
      
      /* Ensure proper spacing between hero and event sections */
      #event-info {
        margin-top: 0 !important; /* Override previous -50px value */
      }
    </style>
  </body>
</html>
